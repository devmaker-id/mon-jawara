<section class="content mt-3">
  <div class="container-fluid">

    <!-- Flash Message -->
    <% if (flashData) { %>
      <div class="alert alert-<%= flashData.type %> alert-dismissible fade show" role="alert">
        <%= flashData.text %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5><i class="bi bi-hdd-rack me-2"></i> NAS Client</h5>
      <a href="/admin/new-nas-use-vpn" class="btn btn-secondary btn-sm">
        <i class="bi bi-plus-circle me-1"></i> Nas Dengan Vpn
      </a>
<!--       <a href="/admin/new-nas-client" class="btn btn-primary btn-sm">
  <i class="bi bi-plus-circle me-1"></i> Tambah NAS
</a> -->
    </div>

    <!-- Tabel NAS Client -->
    <div class="card shadow-sm">
      <div class="card-body table-responsive">
        <table class="table table-bordered table-hover align-middle">
          <thead class="table-info">
            <tr>
              <th>ID</th>
              <th>Nama</th>
              <th>IP Address</th>
              <th>Deskripsi</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <% if (nasClients && nasClients.length > 0) { %>
            <% nasClients.forEach(nas => { %>
              <tr>
                <td><%= nas.id %></td>
                <td class="text-nowrap"><%= nas.shortname %></td>
                <td><%= nas.nasname %></td>
                <td><%= nas.description %></td>
                <td>
                  <% if (nas.status === 'online') { %>
                    <span class="badge bg-success">Online</span>
                  <% } else { %>
                    <span class="badge bg-secondary">Offline</span>
                  <% } %>
                </td>
                <td class="text-nowrap">
                  <button class="btn btn-sm btn-danger" onclick="hapusNas('<%= nas.id %>')">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            <% }) %>
            <% } else { %>
              <tr>
                <td colspan="6" class="text-center">...Tidak Ada Nas...</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</section>

<script>
  async function hapusNas(id) {
    const konfirmasi = await Swal.fire({
      title: "Yakin hapus?",
      text: "Data NAS akan dihapus permanen.",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Ya, hapus!",
      cancelButtonText: "Batal"
    });

    if (!konfirmasi.isConfirmed) return;

    try {
      const res = await fetch(`/admin/nas-client/${id}`, { method: 'DELETE' });
      const data = await res.json();

      if (data.success) {
        Swal.fire("Berhasil", data.message, "success").then(() => location.reload());
      } else {
        Swal.fire("Gagal", data.message || "Terjadi kesalahan saat menghapus.", "error");
      }
    } catch (err) {
      console.error(err);
      Swal.fire("Error", "Gagal menghubungi server.", "error");
    }
  }
</script>
