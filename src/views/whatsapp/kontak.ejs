<div class="app-content-header">
  <div class="container-fluid">
    <div class="d-flex align-items-center justify-content-between">
      <h3 class="mb-0"><%= title %></h3>
      <!-- Tombol untuk memicu modal -->
      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#tambahKontakModal">
        Tambah Kontak
      </button>
    </div>
  </div>
</div>

<div class="app-content py-3">
  <div class="container-fluid">
    
    <% if (message) { %>
      <div class="alert alert-<%= message.type %> alert-dismissible fade show" role="alert">
        <%= message.text %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% } %>

    <div class="card shadow-sm border-0">
      <div class="card-body">
        <table class="table table-hover table-bordered">
          <thead>
            <tr>
              <th>TELEPON</th>
              <th>Nama</th>
              <th>Dibuat</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <% if (kontaks.length > 0) { %>
              <% kontaks.forEach(kontak => { %>
                <tr>
                  <td><%= kontak.jid %></td>
                  <td><%= kontak.name %></td>
                  <td><%= kontak.created_at.toLocaleString() %></td>
                  <td>
                    <a href="/whatsapp/kontak/sendMessage/<%= kontak.id %>" 
                       class="btn btn-info btn-sm" 
                       onclick="return confirm('Coba kirim pesan?\nhalo halo, punten bro. disini monjawa.xyz cek pesan!!!')"><span class="bi bi-phone"></span> Tes</a>
                    <button class="btn btn-primary btn-sm" 
                            data-bs-toggle="modal" 
                            data-bs-target="#editKontakModal"
                            data-id="<%= kontak.id %>"
                            data-jid="<%= kontak.jid %>"
                            data-name="<%= kontak.name %>">
                      <span class="bi bi-pen"></span> Edit
                    </button>
                    <a href="/whatsapp/kontak/hapus/<%= kontak.id %>" 
                       class="btn btn-danger btn-sm" 
                       onclick="return confirm('Yakin ingin menghapus kontak ini?')"><span class="bi bi-trash"></span> Hapus</a>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr>
                <td colspan="5" class="text-center">Belum ada kontak</td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Tambah Kontak -->
<div class="modal fade" id="tambahKontakModal" tabindex="-1" aria-labelledby="tambahKontakModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form action="/whatsapp/kontak/tambah" method="POST" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="tambahKontakModalLabel">Tambah Kontak</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="jid" class="form-label">Nomor Whatsapp</label>
          <input type="number" class="form-control" id="jid" name="jid" placeholder="628123456789" required>
          <small class="text-muted"> <i class="text-danger">Nomor Tanpa Menggunakan tanda (+)</i></small>
        </div>
        <div class="mb-3">
          <label for="name" class="form-label">Nama</label>
          <input type="text" class="form-control" id="name" name="name" placeholder="nama kontak" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="submit" class="btn btn-success">Simpan</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Edit Kontak -->
<div class="modal fade" id="editKontakModal" tabindex="-1" aria-labelledby="editKontakModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form action="/whatsapp/kontak/edit" method="POST" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editKontakModalLabel">Edit Kontak</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="edit-id" name="id">
        <div class="mb-3">
          <label for="edit-jid" class="form-label">JID</label>
          <input type="text" class="form-control" id="edit-jid" name="jid" required>
        </div>
        <div class="mb-3">
          <label for="edit-name" class="form-label">Nama</label>
          <input type="text" class="form-control" id="edit-name" name="name" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="submit" class="btn btn-primary">Update</button>
      </div>
    </form>
  </div>
</div>

<script>
  // Isi data modal edit saat tombol Edit diklik
  var editModal = document.getElementById('editKontakModal');
  editModal.addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var id = button.getAttribute('data-id');
    var jid = button.getAttribute('data-jid');
    var name = button.getAttribute('data-name');

    var modalId = editModal.querySelector('#edit-id');
    var modalJid = editModal.querySelector('#edit-jid');
    var modalName = editModal.querySelector('#edit-name');

    modalId.value = id;
    modalJid.value = jid;
    modalName.value = name;
  });
</script>