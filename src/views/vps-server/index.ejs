<!-- views/vps-server.ejs -->
<section class="content mt-2">
  <div class="container-fluid">
    <div class="card shadow">
      <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
        <h3 class="card-title mb-0">
          <i class="bi bi-hdd-network"></i> VPS Server
        </h3>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalAdd">
          <i class="bi bi-plus-circle"></i> Tambah
        </button>
      </div>

      <div class="card-body table-responsive">
        <table class="table table-bordered table-hover text-center align-middle">
          <thead class="table-light">
            <tr class="text-nowrap">
              <th>Nama Server</th>
              <th>IP Address</th>
              <th>Lokasi</th>
              <th>Provider</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            <% servers.forEach(server => { %>
              <tr class="text-nowrap">
                <td><%= server.name %></td>
                <td><%= server.ip %></td>
                <td><%= server.location %></td>
                <td><%= server.provider %></td>
                <td>
                  <button class="btn btn-sm btn-primary btn-edit" 
                          data-id="<%= server.id %>" 
                          data-name="<%= server.name %>" 
                          data-ip="<%= server.ip %>" 
                          data-location="<%= server.location %>" 
                          data-provider="<%= server.provider %>">
                    <i class="bi bi-pencil-square"></i>
                  </button>

                  <form method="POST" action="/admin/vps/delete/<%= server.id %>" class="d-inline form-delete">
                    <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i></button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<!-- Modal Tambah -->
<div class="modal fade" id="modalAdd" tabindex="-1" aria-labelledby="modalAddLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" action="/admin/vps/create" class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title" id="modalAddLabel">
          <i class="bi bi-plus-circle"></i> Tambah VPS Server
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <label class="form-label">Nama Server</label>
          <input type="text" name="name" class="form-control" required>
        </div>
        <div class="mb-2">
          <label class="form-label">IP Address</label>
          <input type="text" name="ip" class="form-control" required>
        </div>
        <div class="mb-2">
          <label class="form-label">Lokasi</label>
          <input type="text" name="location" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Provider</label>
          <input type="text" name="provider" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success"><i class="bi bi-save"></i> Simpan</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Edit Dinamis -->
<div class="modal fade" id="modalEdit" tabindex="-1" aria-labelledby="modalEditLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form method="POST" id="formEdit" class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="modalEditLabel">
          <i class="bi bi-pencil-square"></i> Ubah VPS Server
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="id" id="edit-id">
        <div class="mb-2">
          <label class="form-label">Nama Server</label>
          <input type="text" name="name" id="edit-name" class="form-control" required>
        </div>
        <div class="mb-2">
          <label class="form-label">IP Address</label>
          <input type="text" name="ip" id="edit-ip" class="form-control" required>
        </div>
        <div class="mb-2">
          <label class="form-label">Lokasi</label>
          <input type="text" name="location" id="edit-location" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Provider</label>
          <input type="text" name="provider" id="edit-provider" class="form-control">
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary"><i class="bi bi-save"></i> Simpan Perubahan</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
      </div>
    </form>
  </div>
</div>

<!-- JS Section -->
<script>
  // Tombol Edit - isi modal edit
  $(".btn-edit").on("click", function () {
    const id = $(this).data("id");
    $("#edit-id").val(id);
    $("#edit-name").val($(this).data("name"));
    $("#edit-ip").val($(this).data("ip"));
    $("#edit-location").val($(this).data("location"));
    $("#edit-provider").val($(this).data("provider"));
    $("#formEdit").attr("action", `/admin/vps/update/${id}`);
    $("#modalEdit").modal("show");
  });

  // Hapus dengan Swal
  $(".form-delete").on("submit", function (e) {
    e.preventDefault();
    const form = this;
    Swal.fire({
      title: "Yakin ingin menghapus?",
      text: "Data tidak bisa dikembalikan!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Ya, hapus!",
      cancelButtonText: "Batal",
      confirmButtonColor: "#d33"
    }).then((result) => {
      if (result.isConfirmed) {
        form.submit();
      }
    });
  });

  // Notifikasi dari backend
  <% if (typeof success !== 'undefined') { %>
    Swal.fire("Berhasil!", "<%= success %>", "success");
  <% } %>
  <% if (typeof error !== 'undefined') { %>
    Swal.fire("Gagal!", "<%= error %>", "error");
  <% } %>
</script>
